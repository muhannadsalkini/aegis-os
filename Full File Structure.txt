aegis-os/
â”‚
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                   # Next.js 15 frontend (Aegis Dashboard)
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ [agentId]/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatStreamViewer.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ToolCallStream.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AgentCard.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CreateAgentModal.tsx
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ trpc/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ provider.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stream.ts     # Uses Vercel AI SDK
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ tailwind.config.js
â”‚   â”‚
â”‚   â””â”€â”€ agent-backend/           # Node agent engine (Express/Fastify)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ server.ts
â”‚       â”‚   â”œâ”€â”€ config/
â”‚       â”‚   â”‚   â”œâ”€â”€ env.ts
â”‚       â”‚   â”‚   â””â”€â”€ openai.ts
â”‚       â”‚   â”œâ”€â”€ agents/
â”‚       â”‚   â”‚   â”œâ”€â”€ index.ts          # Agent registry
â”‚       â”‚   â”‚   â”œâ”€â”€ base-agent.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ orchestrator-agent.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ researcher-agent.ts
â”‚       â”‚   â”‚   â””â”€â”€ convo-agent.ts
â”‚       â”‚   â”œâ”€â”€ tools/
â”‚       â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ http/
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ fetch.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ system/
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ time.ts
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ logger.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ database/
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ insertRecord.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ search/
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ webSearch.ts
â”‚       â”‚   â”‚   â””â”€â”€ email/
â”‚       â”‚   â”‚       â””â”€â”€ sendEmail.ts
â”‚       â”‚   â”œâ”€â”€ rag/
â”‚       â”‚   â”‚   â”œâ”€â”€ embeddings.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ chunking.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ loader.ts
â”‚       â”‚   â”‚   â””â”€â”€ retriever.ts
â”‚       â”‚   â”œâ”€â”€ routes/
â”‚       â”‚   â”‚   â”œâ”€â”€ agent.route.ts         # POST /agents/:id/respond
â”‚       â”‚   â”‚   â”œâ”€â”€ tools.route.ts
â”‚       â”‚   â”‚   â””â”€â”€ rag.route.ts
â”‚       â”‚   â”œâ”€â”€ mcp/
â”‚       â”‚   â”‚   â”œâ”€â”€ server.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ file-system/
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ fs.mcp.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ db/
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ pg.mcp.ts
â”‚       â”‚   â”‚   â””â”€â”€ http/
â”‚       â”‚   â”‚       â””â”€â”€ fetch.mcp.ts
â”‚       â”‚   â”œâ”€â”€ types/
â”‚       â”‚   â”‚   â”œâ”€â”€ agent.ts
â”‚       â”‚   â”‚   â””â”€â”€ tool.ts
â”‚       â”‚   â””â”€â”€ utils/
â”‚       â”‚       â”œâ”€â”€ stream.ts             # SSE streaming helper
â”‚       â”‚       â”œâ”€â”€ logger.ts
â”‚       â”‚       â””â”€â”€ id.ts
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared-types/            # Zod types, DTOs, utilities
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”‚   â”œâ”€â”€ agent.schema.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ message.schema.ts
â”‚   â”‚   â”‚   â””â”€â”€ tool.schema.ts
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ validators.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/                      # Shared UI components (optional)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ sdk/                     # JS SDK to call your agents
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ client.ts
â”‚       â””â”€â”€ streaming.ts
â”‚
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ backend.Dockerfile
â”‚   â”œâ”€â”€ web.Dockerfile
â”‚   â””â”€â”€ compose.yaml
â”‚
â””â”€â”€ tsconfig.json



ğŸ’¡ Key Architectural Notes
1. Two-app structure

web â†’ UI for managing agents, tools, KBs, streaming

agent-backend â†’ runs the agents, tools, MCP, RAG, streaming

Like a cockpit + engine room.

2. Agents are isolated modules

Located in:

agent-backend/src/agents/


Every agent:

Has a config

Has allowed tools

Has its own reasoning loop

Can call other agents through the orchestrator

3. Tools are atomic functions

Each tool has:

JSON schema

A TypeScript implementation

Registration entry

4. RAG is its own universe
rag/
  embeddings.ts
  chunking.ts
  loader.ts
  retriever.ts


Keeps it flexible enough to swap Supabase â†” Qdrant.

5. MCP support included

MCP servers live in:

mcp/


Each MCP â€œtool offerâ€ is cleanly separated.

6. Full Streaming Support

In both:

apps/web/lib/ai/stream.ts

agent-backend/utils/stream.ts

Handles token-by-token output + tool logs.